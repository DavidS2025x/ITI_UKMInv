<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Icons\UKM_InvDB_Transparent_Alt.ico">
    <title>Pregled Oseb</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="CSS\style.css">
    <script src="JS/main.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</head>
<body>
    <!-- NAVIGATION -->
    <div class="container-fluid mt-5 w-75">
        <div>
            <button class="btn btn-outline-primary" onclick="tabela('osebe')">Osebe</button>
            <button class="btn btn-outline-primary" onclick="tabela('enote')">Enote</button>
            <button class="btn btn-outline-primary" onclick="tabela('sluzbe')">Službe</button>
            <button class="btn btn-outline-primary" onclick="tabela('uporabniki')">Uporabniki</button>
        </div>
        <div id="table-responsive"></div>
    </div>
</body>

<script>
    window.addEventListener("DOMContentLoaded", () => {
                uporabnikPodatki()
                .then(data => {
                    // Update navbar with user info
                    document.getElementById('username').textContent = data.Ime + ' ' + data.Priimek;
                    // Generate action buttons based on permissions
                    addNavigationLinks(data);
                    console.log(data);
                }).catch(err => {
                    console.error('Error loading user data:', err);
                });
                tabela();
            });
        
        let grid = null;

function tabela(izbor) {
    
    let url;
    switch (izbor) {
        case 'osebe': url = '/osebaPodatki'; break;
        case 'enote': url = '/enotaPodatki'; break;
        case 'sluzbe': url = '/sluzbaPodatki'; break;
        case 'uporabniki': url = '/uporabnikPodatki'; break;
        default: url = '/osebaPodatki';
    }

    fetch(url)
        .then(r => r.json())
        .then(data => {
            if (!data.length) return;

            const container = document.getElementById("table-responsive");

            container.innerHTML = ""; // Clear previous table
            grid?.destroy(); // Destroy previous grid instance if exists

            const datacolumns = Object.keys(data[0]);
            console.log(datacolumns);
            const columns = [
                ...datacolumns,
                    {
                        name: 'Akcije',
                        formatter: (cell, row) => {
                        return gridjs.h('div', {}, [
                            gridjs.h('button', {
                            className: 'btn btn-sm btn-primary me-1', // optional spacing
                            onClick: () => alert(`Uredi: ${row.cells[0].data}`)
                            }, 'Uredi'),
                            gridjs.h('button', {
                            className: 'btn btn-sm btn-danger',
                            onClick: () => alert(`Briši: ${row.cells[0].data}`)
                            }, 'Briši')
                        ]);
                        }
                    }
                ];

            const rows = data.map(row => datacolumns.map(col => row[col]));

            grid = new gridjs.Grid({
                columns,
                data: rows,
                search: true,
                sort: true,
                pagination: { enabled: true, limit: 10 }
            }).render(container);

            const input = container.querySelector('.gridjs-input');
            if (input) {
                input.setAttribute('placeholder', 'Išči...');
            }

            const head = container.querySelector('.gridjs-search');
            console.log(head);
            if (head) {
                const buttonAdd = document.createElement('button');
                buttonAdd.className = 'btn btn-sm btn-primary ms-2';
                buttonAdd.textContent = '+';
                buttonAdd.onclick = () => alert(`Dodaj novo vrstico`);
                head.appendChild(buttonAdd);
            }
        });
    }
</script>

</html>