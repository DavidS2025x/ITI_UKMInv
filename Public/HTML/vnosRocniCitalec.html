<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Icons\UKM_InvDB_Transparent_Alt.ico">
    <title>Nov ročni čitalec</title>
    <script src="JS/main.js" type="module"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="CSS\style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

</head>
<body>
    <!-- NAVIGATION -->
    <!-- FORM -->
</body>
<script>
    window.addEventListener("DOMContentLoaded", () => {
                uporabnikPodatki()
                .then(data => {
                    // Update navbar with user info
                    document.getElementById('username').textContent = data.Ime + ' ' + data.Priimek;
                    // Generate action buttons based on permissions
                    addNavigationLinks(data)
                    .then(() => {
                        const currentWindow = window.location.pathname.split('/').pop();
                        const links = document.querySelectorAll('#navLinksContainer .nav-link');
                        links.forEach(link => {
                            if (link.getAttribute('href').includes(currentWindow)) {
                                link.classList.add('active');
                            }
                        });
                    });
                }).catch(err => {
                    console.error('Error loading user data:', err);
                });

                fetch('/proizvajalecPodatkiForm')
                .then(response => response.json())
                .then(data => {
                    const input = document.getElementById('OznakaProizvajalca');
                    data.forEach(data => {
                        const option = document.createElement('option');
                        option.value = data.OznakaProizvajalca;
                        option.textContent = data.NazivProizvajalca;
                        input.appendChild(option);
                    });
                });

                fetch('/lokacijaPodatkiForm')
                .then(response => response.json())
                .then(data => {
                    const input = document.getElementById('OznakaLokacije');
                    data.forEach(data => {
                        const option = document.createElement('option');
                        option.value = data.OznakaLokacije;
                        option.textContent = data.NazivLokacije;
                        input.appendChild(option);
                    });
                });

                fetch('/osebaPodatkiForm')
                .then(response => response.json())
                .then(data => {
                    const input = document.getElementById('OznakaOsebeUporabniskoIme');
                    data.forEach(data => {
                        const option = document.createElement('option');
                        option.value = data.UporabniskoIme;
                        option.textContent = data.Ime;
                        input.appendChild(option);
                    });
                });

                fetch('/sluzbaPodatkiForm')
                .then(response => response.json())
                .then(data => {
                    const input = document.getElementById('OznakaSluzbe');
                    data.forEach(data => {
                        const option = document.createElement('option');
                        option.value = data.OznakaSluzbe;
                        option.textContent = data.NazivSluzbe;
                        input.appendChild(option);
                    });
                });
                
                fetch('/enotaPodatkiForm')
                .then(response => response.json())
                .then(data => {
                    const input = document.getElementById('OznakaEnote');
                    data.forEach(data => {
                        const option = document.createElement('option');
                        option.value = data.OznakaEnote;
                        option.textContent = data.NazivEnote;
                        input.appendChild(option);
                    });
                });

                fetch('/delovnaPostajaPodatkiForm')
                .then(response => response.json())
                .then(data => {
                    const input = document.getElementById('OznakaDP');
                    data.forEach(data => {
                        const option = document.createElement('option');
                        option.value = data.OznakaDP;
                        option.textContent = data.OznakaDP;
                        input.appendChild(option);
                    })
                })

                document.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const form = event.target;
                    const payload = {
                        OznakaRocnegaCitalca: form.OznakaRocnegaCitalca.value,
                        ModelRocnegaCitalca: form.ModelRocnegaCitalca.value,
                        OznakaProizvajalca: form.OznakaProizvajalca.value,
                        OznakaDP: form.OznakaDP.value,
                        OznakaLokacije: form.OznakaLokacije.value,
                        InventarnaStevilka: form.InventarnaStevilka.value,
                        OznakaOsebeUporabniskoIme: form.OznakaOsebeUporabniskoIme.value,
                        OznakaEnote: form.OznakaEnote.value,
                        OznakaSluzbe: form.OznakaSluzbe.value,
                        Stojalo: form.OznakaSluzbe.value,
                        SerijskaStevilka: form.SerijskaStevilka.value,
                        DatumProizvodnje: form.DatumProizvodnje.value,
                        DatumNakupa: form.DatumNakupa.value,
                        Opombe: form.Opombe.value
                    };
                    console.log(payload);
                    fetch(form.action, {
                        method: form.method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    })
                    .then(response => {
                        if (response.ok) {
                            alert('Ročni čitalec uspešno dodan!');
                            form.reset();
                        } else {
                            response.json().then(j => console.error(j)).catch(()=>{});
                            alert('Napaka pri dodajanju ročnega čitalca.');
                        }
                    })
                    .catch(error => {
                        console.error('Error submitting form:', error);
                        alert('Napaka pri dodajanju ročnega čitalca.');
                    });
                });
            });
</script>